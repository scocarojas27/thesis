{"ast":null,"code":"'use strict';\n\nvar asap = require('asap');\n\nvar PENDING = -1,\n    FULFILLED = 0,\n    REJECTED = 1;\n\nvar Promise = function (task) {\n  this._state = PENDING;\n  this._value = null;\n  this._defer = [];\n  execute(this, task);\n};\n\nPromise.prototype.then = function (onFulfilled, onRejected) {\n  var promise = new Promise();\n  var deferred = {\n    promise: promise,\n    onFulfilled: onFulfilled,\n    onRejected: onRejected\n  };\n  if (this._state === PENDING) this._defer.push(deferred);else propagate(this, deferred);\n  return promise;\n};\n\nPromise.prototype['catch'] = function (onRejected) {\n  return this.then(null, onRejected);\n};\n\nvar execute = function (promise, task) {\n  if (typeof task !== 'function') return;\n  var calls = 0;\n\n  var resolvePromise = function (value) {\n    if (calls++ === 0) resolve(promise, value);\n  };\n\n  var rejectPromise = function (reason) {\n    if (calls++ === 0) reject(promise, reason);\n  };\n\n  try {\n    task(resolvePromise, rejectPromise);\n  } catch (error) {\n    rejectPromise(error);\n  }\n};\n\nvar propagate = function (promise, deferred) {\n  var state = promise._state,\n      value = promise._value,\n      next = deferred.promise,\n      handler = [deferred.onFulfilled, deferred.onRejected][state],\n      pass = [resolve, reject][state];\n  if (typeof handler !== 'function') return pass(next, value);\n  asap(function () {\n    try {\n      resolve(next, handler(value));\n    } catch (error) {\n      reject(next, error);\n    }\n  });\n};\n\nvar resolve = function (promise, value) {\n  if (promise === value) return reject(promise, new TypeError('Recursive promise chain detected'));\n  var then;\n\n  try {\n    then = getThen(value);\n  } catch (error) {\n    return reject(promise, error);\n  }\n\n  if (!then) return fulfill(promise, value);\n  execute(promise, function (resolvePromise, rejectPromise) {\n    then.call(value, resolvePromise, rejectPromise);\n  });\n};\n\nvar getThen = function (value) {\n  var type = typeof value,\n      then = (type === 'object' || type === 'function') && value && value.then;\n  return typeof then === 'function' ? then : null;\n};\n\nvar fulfill = function (promise, value) {\n  settle(promise, FULFILLED, value);\n};\n\nvar reject = function (promise, reason) {\n  settle(promise, REJECTED, reason);\n};\n\nvar settle = function (promise, state, value) {\n  var defer = promise._defer,\n      i = 0;\n  promise._state = state;\n  promise._value = value;\n  promise._defer = null;\n  if (defer.length === 0) return;\n\n  while (i < defer.length) propagate(promise, defer[i++]);\n};\n\nPromise.resolve = function (value) {\n  try {\n    if (getThen(value)) return value;\n  } catch (error) {\n    return Promise.reject(error);\n  }\n\n  return new Promise(function (resolve, reject) {\n    resolve(value);\n  });\n};\n\nPromise.reject = function (reason) {\n  return new Promise(function (resolve, reject) {\n    reject(reason);\n  });\n};\n\nPromise.all = function (promises) {\n  return new Promise(function (resolve, reject) {\n    var list = [],\n        n = promises.length,\n        i;\n    if (n === 0) return resolve(list);\n\n    var push = function (promise, i) {\n      Promise.resolve(promise).then(function (value) {\n        list[i] = value;\n        if (--n === 0) resolve(list);\n      }, reject);\n    };\n\n    for (i = 0; i < n; i++) push(promises[i], i);\n  });\n};\n\nPromise.race = function (promises) {\n  return new Promise(function (resolve, reject) {\n    for (var i = 0, n = promises.length; i < n; i++) Promise.resolve(promises[i]).then(resolve, reject);\n  });\n};\n\nPromise.deferred = function () {\n  var tuple = {};\n  tuple.promise = new Promise(function (resolve, reject) {\n    tuple.resolve = resolve;\n    tuple.reject = reject;\n  });\n  return tuple;\n};\n\nmodule.exports = Promise;","map":{"version":3,"sources":["/home/scocarojas/Documents/prototype/node_modules/faye/src/util/promise.js"],"names":["asap","require","PENDING","FULFILLED","REJECTED","Promise","task","_state","_value","_defer","execute","prototype","then","onFulfilled","onRejected","promise","deferred","push","propagate","calls","resolvePromise","value","resolve","rejectPromise","reason","reject","error","state","next","handler","pass","TypeError","getThen","fulfill","call","type","settle","defer","i","length","all","promises","list","n","race","tuple","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nvar asap = require('asap');\n\nvar PENDING   = -1,\n    FULFILLED =  0,\n    REJECTED  =  1;\n\nvar Promise = function(task) {\n  this._state = PENDING;\n  this._value = null;\n  this._defer = [];\n\n  execute(this, task);\n};\n\nPromise.prototype.then = function(onFulfilled, onRejected) {\n  var promise = new Promise();\n\n  var deferred = {\n    promise:     promise,\n    onFulfilled: onFulfilled,\n    onRejected:  onRejected\n  };\n\n  if (this._state === PENDING)\n    this._defer.push(deferred);\n  else\n    propagate(this, deferred);\n\n  return promise;\n};\n\nPromise.prototype['catch'] = function(onRejected) {\n  return this.then(null, onRejected);\n};\n\nvar execute = function(promise, task) {\n  if (typeof task !== 'function') return;\n\n  var calls = 0;\n\n  var resolvePromise = function(value) {\n    if (calls++ === 0) resolve(promise, value);\n  };\n\n  var rejectPromise = function(reason) {\n    if (calls++ === 0) reject(promise, reason);\n  };\n\n  try {\n    task(resolvePromise, rejectPromise);\n  } catch (error) {\n    rejectPromise(error);\n  }\n};\n\nvar propagate = function(promise, deferred) {\n  var state   = promise._state,\n      value   = promise._value,\n      next    = deferred.promise,\n      handler = [deferred.onFulfilled, deferred.onRejected][state],\n      pass    = [resolve, reject][state];\n\n  if (typeof handler !== 'function')\n    return pass(next, value);\n\n  asap(function() {\n    try {\n      resolve(next, handler(value));\n    } catch (error) {\n      reject(next, error);\n    }\n  });\n};\n\nvar resolve = function(promise, value) {\n  if (promise === value)\n    return reject(promise, new TypeError('Recursive promise chain detected'));\n\n  var then;\n\n  try {\n    then = getThen(value);\n  } catch (error) {\n    return reject(promise, error);\n  }\n\n  if (!then) return fulfill(promise, value);\n\n  execute(promise, function(resolvePromise, rejectPromise) {\n    then.call(value, resolvePromise, rejectPromise);\n  });\n};\n\nvar getThen = function(value) {\n  var type = typeof value,\n      then = (type === 'object' || type === 'function') && value && value.then;\n\n  return (typeof then === 'function')\n         ? then\n         : null;\n};\n\nvar fulfill = function(promise, value) {\n  settle(promise, FULFILLED, value);\n};\n\nvar reject = function(promise, reason) {\n  settle(promise, REJECTED, reason);\n};\n\nvar settle = function(promise, state, value) {\n  var defer = promise._defer, i = 0;\n\n  promise._state = state;\n  promise._value = value;\n  promise._defer = null;\n\n  if (defer.length === 0) return;\n  while (i < defer.length) propagate(promise, defer[i++]);\n};\n\nPromise.resolve = function(value) {\n  try {\n    if (getThen(value)) return value;\n  } catch (error) {\n    return Promise.reject(error);\n  }\n\n  return new Promise(function(resolve, reject) { resolve(value) });\n};\n\nPromise.reject = function(reason) {\n  return new Promise(function(resolve, reject) { reject(reason) });\n};\n\nPromise.all = function(promises) {\n  return new Promise(function(resolve, reject) {\n    var list = [], n = promises.length, i;\n\n    if (n === 0) return resolve(list);\n\n    var push = function(promise, i) {\n      Promise.resolve(promise).then(function(value) {\n        list[i] = value;\n        if (--n === 0) resolve(list);\n      }, reject);\n    };\n\n    for (i = 0; i < n; i++) push(promises[i], i);\n  });\n};\n\nPromise.race = function(promises) {\n  return new Promise(function(resolve, reject) {\n    for (var i = 0, n = promises.length; i < n; i++)\n      Promise.resolve(promises[i]).then(resolve, reject);\n  });\n};\n\nPromise.deferred = function() {\n  var tuple = {};\n\n  tuple.promise = new Promise(function(resolve, reject) {\n    tuple.resolve = resolve;\n    tuple.reject  = reject;\n  });\n  return tuple;\n};\n\nmodule.exports = Promise;\n"]},"metadata":{},"sourceType":"script"}