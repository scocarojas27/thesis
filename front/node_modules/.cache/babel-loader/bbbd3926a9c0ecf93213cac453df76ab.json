{"ast":null,"code":"'use strict';\n\nvar Class = require('../util/class'),\n    URI = require('../util/uri'),\n    browser = require('../util/browser'),\n    assign = require('../util/assign'),\n    toJSON = require('../util/to_json'),\n    Transport = require('./transport');\n\nvar XHR = assign(Class(Transport, {\n  encode: function (messages) {\n    return toJSON(messages);\n  },\n  request: function (messages) {\n    var href = this.endpoint.href,\n        self = this,\n        xhr; // Prefer XMLHttpRequest over ActiveXObject if they both exist\n\n    if (global.XMLHttpRequest) {\n      xhr = new XMLHttpRequest();\n    } else if (global.ActiveXObject) {\n      xhr = new ActiveXObject('Microsoft.XMLHTTP');\n    } else {\n      return this._handleError(messages);\n    }\n\n    xhr.open('POST', href, true);\n    xhr.setRequestHeader('Content-Type', 'application/json');\n    xhr.setRequestHeader('Pragma', 'no-cache');\n    xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n    var headers = this._dispatcher.headers;\n\n    for (var key in headers) {\n      if (!headers.hasOwnProperty(key)) continue;\n      xhr.setRequestHeader(key, headers[key]);\n    }\n\n    var abort = function () {\n      xhr.abort();\n    };\n\n    if (global.onbeforeunload !== undefined) browser.Event.on(global, 'beforeunload', abort);\n\n    xhr.onreadystatechange = function () {\n      if (!xhr || xhr.readyState !== 4) return;\n      var replies = null,\n          status = xhr.status,\n          text = xhr.responseText,\n          successful = status >= 200 && status < 300 || status === 304 || status === 1223;\n      if (global.onbeforeunload !== undefined) browser.Event.detach(global, 'beforeunload', abort);\n\n      xhr.onreadystatechange = function () {};\n\n      xhr = null;\n      if (!successful) return self._handleError(messages);\n\n      try {\n        replies = JSON.parse(text);\n      } catch (error) {}\n\n      if (replies) self._receive(replies);else self._handleError(messages);\n    };\n\n    xhr.send(this.encode(messages));\n    return xhr;\n  }\n}), {\n  isUsable: function (dispatcher, endpoint, callback, context) {\n    var usable = navigator.product === 'ReactNative' || URI.isSameOrigin(endpoint);\n    callback.call(context, usable);\n  }\n});\nmodule.exports = XHR;","map":{"version":3,"sources":["/home/scocarojas/Documents/prototype/node_modules/faye/src/transport/xhr.js"],"names":["Class","require","URI","browser","assign","toJSON","Transport","XHR","encode","messages","request","href","endpoint","self","xhr","global","XMLHttpRequest","ActiveXObject","_handleError","open","setRequestHeader","headers","_dispatcher","key","hasOwnProperty","abort","onbeforeunload","undefined","Event","on","onreadystatechange","readyState","replies","status","text","responseText","successful","detach","JSON","parse","error","_receive","send","isUsable","dispatcher","callback","context","usable","navigator","product","isSameOrigin","call","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nvar Class     = require('../util/class'),\n    URI       = require('../util/uri'),\n    browser   = require('../util/browser'),\n    assign    = require('../util/assign'),\n    toJSON    = require('../util/to_json'),\n    Transport = require('./transport');\n\nvar XHR = assign(Class(Transport, {\n  encode: function(messages) {\n    return toJSON(messages);\n  },\n\n  request: function(messages) {\n    var href = this.endpoint.href,\n        self = this,\n        xhr;\n\n    // Prefer XMLHttpRequest over ActiveXObject if they both exist\n    if (global.XMLHttpRequest) {\n      xhr = new XMLHttpRequest();\n    } else if (global.ActiveXObject) {\n      xhr = new ActiveXObject('Microsoft.XMLHTTP');\n    } else {\n      return this._handleError(messages);\n    }\n\n    xhr.open('POST', href, true);\n    xhr.setRequestHeader('Content-Type', 'application/json');\n    xhr.setRequestHeader('Pragma', 'no-cache');\n    xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n\n    var headers = this._dispatcher.headers;\n    for (var key in headers) {\n      if (!headers.hasOwnProperty(key)) continue;\n      xhr.setRequestHeader(key, headers[key]);\n    }\n\n    var abort = function() { xhr.abort() };\n    if (global.onbeforeunload !== undefined)\n      browser.Event.on(global, 'beforeunload', abort);\n\n    xhr.onreadystatechange = function() {\n      if (!xhr || xhr.readyState !== 4) return;\n\n      var replies    = null,\n          status     = xhr.status,\n          text       = xhr.responseText,\n          successful = (status >= 200 && status < 300) || status === 304 || status === 1223;\n\n      if (global.onbeforeunload !== undefined)\n        browser.Event.detach(global, 'beforeunload', abort);\n\n      xhr.onreadystatechange = function() {};\n      xhr = null;\n\n      if (!successful) return self._handleError(messages);\n\n      try {\n        replies = JSON.parse(text);\n      } catch (error) {}\n\n      if (replies)\n        self._receive(replies);\n      else\n        self._handleError(messages);\n    };\n\n    xhr.send(this.encode(messages));\n    return xhr;\n  }\n}), {\n  isUsable: function(dispatcher, endpoint, callback, context) {\n    var usable = (navigator.product === 'ReactNative')\n              || URI.isSameOrigin(endpoint);\n\n    callback.call(context, usable);\n  }\n});\n\nmodule.exports = XHR;\n"]},"metadata":{},"sourceType":"script"}