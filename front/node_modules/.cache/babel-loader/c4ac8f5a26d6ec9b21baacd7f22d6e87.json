{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\n\nvar _formData = _interopRequireDefault(require(\"form-data\"));\n\nvar _errors = _interopRequireDefault(require(\"./errors\"));\n\nvar validFeedSlugRe = /^[\\w]+$/;\nvar validUserIdRe = /^[\\w-]+$/;\n\nfunction validateFeedSlug(feedSlug) {\n  /*\n   * Validate that the feedSlug matches \\w\n   */\n  if (!validFeedSlugRe.test(feedSlug)) {\n    throw new _errors.default.FeedError(\"Invalid feedSlug, please use letters, numbers or _: \".concat(feedSlug));\n  }\n\n  return feedSlug;\n}\n\nfunction validateUserId(userId) {\n  /*\n   * Validate the userId matches \\w\n   */\n  if (!validUserIdRe.test(userId)) {\n    throw new _errors.default.FeedError(\"Invalid userId, please use letters, numbers, - or _: \".concat(userId));\n  }\n\n  return userId;\n}\n\nfunction rfc3986(str) {\n  return str.replace(/[!'()*]/g, function (c) {\n    return \"%\".concat(c.charCodeAt(0).toString(16).toUpperCase());\n  });\n}\n\nfunction isReadableStream(obj) {\n  return obj && (0, _typeof2.default)(obj) === 'object' && typeof obj._read === 'function' && (0, _typeof2.default)(obj._readableState) === 'object';\n}\n\nfunction validateFeedId(feedId) {\n  /*\n   * Validate that the feedId matches the spec user:1\n   */\n  var parts = feedId.split(':');\n\n  if (parts.length !== 2) {\n    throw new _errors.default.FeedError(\"Invalid feedId, expected something like user:1 got \".concat(feedId));\n  }\n\n  var _parts = (0, _slicedToArray2.default)(parts, 2),\n      feedSlug = _parts[0],\n      userId = _parts[1];\n\n  validateFeedSlug(feedSlug);\n  validateUserId(userId);\n  return feedId;\n}\n\nfunction addFileToFormData(uri, name, contentType) {\n  var data = new _formData.default();\n  var fileField;\n\n  if (isReadableStream(uri) || uri && uri.toString && uri.toString() === '[object File]') {\n    fileField = uri;\n  } else {\n    fileField = {\n      uri: uri,\n      name: name || uri.split('/').reverse()[0]\n    };\n    if (contentType != null) fileField.type = contentType;\n  }\n\n  data.append('file', fileField);\n  return data;\n}\n\nfunction replaceStreamObjects(obj) {\n  if (Array.isArray(obj)) return obj.map(function (v) {\n    return replaceStreamObjects(v);\n  });\n  if (Object.prototype.toString.call(obj) !== '[object Object]') return obj;\n  if (typeof obj.ref === 'function') return obj.ref();\n  var cloned = {};\n  Object.keys(obj).forEach(function (k) {\n    cloned[k] = replaceStreamObjects(obj[k]);\n  });\n  return cloned;\n}\n\nvar _default = {\n  validateFeedId: validateFeedId,\n  validateFeedSlug: validateFeedSlug,\n  validateUserId: validateUserId,\n  rfc3986: rfc3986,\n  isReadableStream: isReadableStream,\n  addFileToFormData: addFileToFormData,\n  replaceStreamObjects: replaceStreamObjects\n};\nexports.default = _default;","map":{"version":3,"sources":["/home/scocarojas/Documents/prototype/node_modules/getstream/lib/lib/utils.js"],"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","default","_slicedToArray2","_typeof2","_formData","_errors","validFeedSlugRe","validUserIdRe","validateFeedSlug","feedSlug","test","FeedError","concat","validateUserId","userId","rfc3986","str","replace","c","charCodeAt","toString","toUpperCase","isReadableStream","obj","_read","_readableState","validateFeedId","feedId","parts","split","length","_parts","addFileToFormData","uri","name","contentType","data","fileField","reverse","type","append","replaceStreamObjects","Array","isArray","map","v","prototype","call","ref","cloned","keys","forEach","k","_default"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\n\nvar _formData = _interopRequireDefault(require(\"form-data\"));\n\nvar _errors = _interopRequireDefault(require(\"./errors\"));\n\nvar validFeedSlugRe = /^[\\w]+$/;\nvar validUserIdRe = /^[\\w-]+$/;\n\nfunction validateFeedSlug(feedSlug) {\n  /*\n   * Validate that the feedSlug matches \\w\n   */\n  if (!validFeedSlugRe.test(feedSlug)) {\n    throw new _errors.default.FeedError(\"Invalid feedSlug, please use letters, numbers or _: \".concat(feedSlug));\n  }\n\n  return feedSlug;\n}\n\nfunction validateUserId(userId) {\n  /*\n   * Validate the userId matches \\w\n   */\n  if (!validUserIdRe.test(userId)) {\n    throw new _errors.default.FeedError(\"Invalid userId, please use letters, numbers, - or _: \".concat(userId));\n  }\n\n  return userId;\n}\n\nfunction rfc3986(str) {\n  return str.replace(/[!'()*]/g, function (c) {\n    return \"%\".concat(c.charCodeAt(0).toString(16).toUpperCase());\n  });\n}\n\nfunction isReadableStream(obj) {\n  return obj && (0, _typeof2.default)(obj) === 'object' && typeof obj._read === 'function' && (0, _typeof2.default)(obj._readableState) === 'object';\n}\n\nfunction validateFeedId(feedId) {\n  /*\n   * Validate that the feedId matches the spec user:1\n   */\n  var parts = feedId.split(':');\n\n  if (parts.length !== 2) {\n    throw new _errors.default.FeedError(\"Invalid feedId, expected something like user:1 got \".concat(feedId));\n  }\n\n  var _parts = (0, _slicedToArray2.default)(parts, 2),\n      feedSlug = _parts[0],\n      userId = _parts[1];\n\n  validateFeedSlug(feedSlug);\n  validateUserId(userId);\n  return feedId;\n}\n\nfunction addFileToFormData(uri, name, contentType) {\n  var data = new _formData.default();\n  var fileField;\n\n  if (isReadableStream(uri) || uri && uri.toString && uri.toString() === '[object File]') {\n    fileField = uri;\n  } else {\n    fileField = {\n      uri: uri,\n      name: name || uri.split('/').reverse()[0]\n    };\n    if (contentType != null) fileField.type = contentType;\n  }\n\n  data.append('file', fileField);\n  return data;\n}\n\nfunction replaceStreamObjects(obj) {\n  if (Array.isArray(obj)) return obj.map(function (v) {\n    return replaceStreamObjects(v);\n  });\n  if (Object.prototype.toString.call(obj) !== '[object Object]') return obj;\n  if (typeof obj.ref === 'function') return obj.ref();\n  var cloned = {};\n  Object.keys(obj).forEach(function (k) {\n    cloned[k] = replaceStreamObjects(obj[k]);\n  });\n  return cloned;\n}\n\nvar _default = {\n  validateFeedId: validateFeedId,\n  validateFeedSlug: validateFeedSlug,\n  validateUserId: validateUserId,\n  rfc3986: rfc3986,\n  isReadableStream: isReadableStream,\n  addFileToFormData: addFileToFormData,\n  replaceStreamObjects: replaceStreamObjects\n};\nexports.default = _default;"]},"metadata":{},"sourceType":"script"}